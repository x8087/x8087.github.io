title: zparseopts的使用帮助
date: 2015-09-10 09:44:06
tags: [zsh, zparseopts, getopts]
---

`zparseopts [ -DKME ] [ -a array ] [ -A assoc ] spec ...`

---
这个内部命令简化位置参数$*的分析。每个spec描述一个选项，且必须使用`opt[=array]`的格式。如果位置参数中包含`opt`描述的选项，该选项将复制到`-a array`指定和`opt`后`=array`指定的`array`中。
**注意：**如果没用使用`-a`或`-A`选项指定`array`，且`spec`中也没有使用`=array`，命令会报错。
除非设置`-E`选项，分析中遇到任何一个不是描述`spec`的字符串都会停止。就算使用`-E`，分析中遇到`-`或者`--`的位置参数也会停止。
`opt`描述必须下面中的一个。特殊字符能在前面加反斜杠显示在提供的选项名中。
`name` `name+`
`name`是选项名去掉前缀`-`。GNU样式的长选项是特殊情况，`name`包含`--`中的一个；例如，`--file`选项的`name`相当于`-file`。
如果`name`后带`+`，位置参数中每次发现该选项都会添加到`array`，没有带`+`则只保存最后一个出现的选项。
使用这种格式，选项不带参数，所以分析时如果下一个位置参数不是以`-`开头将自动停止（除非使用`-E`选项）。
`name:` `name:-` `name::`
如果有`:`或者`::`，则选项带参数。一个冒号表示参数强制，两个冒号表示参数可选。
`array`的第一个值是选项名，参数添加到选项名后。
可选参数和选项名放在同一个数组项（ **注意** 这使得空字符串参数难以区分）。强制参数则添加到单独的数组项，除非使用`:-`才能和选项名放在同一个数组项。
上面描述的`+`可以出现在`name`和第一个冒号`:`中间。


<!-- more -->
---

**zparseopts选项:**
`-a array`
如上所述，指定默认数组名，保存识别出的选项。

`-A assoc`
使用该选项可以把选项和值以选项名为键选项参数为值放到关联数组内。

`-D`
使用该选项可以把所有找到的调用shell和shell方法的位置参数删除。最多但是不包括任何`spec`没描述的。这和使用内部命令`shift`类似。

`-K`
使用该选项可以使`-a`选项指定和`=array`格式的数组在没有`spec`使用到时保持不变。另一方面，当任何`spec`使用到时替换整个数组。通过`-A`选项指定的关联数组单独项使用`-K`保存。这使得可以在调用`zparseopts`前指派默认值到数组里。

`-M`
实现相同选项名之间映射的指派规则变化。任何使用`=array`格式来选择值保存在哪里的`spec`，字符串`array`被解释为另一个`spec`的名字。如果没有找到其他`spec`，选项值按往常保存。这只是选项值保存方法的变化，不是`$*`被解析的方法，所以如果`name+`指定不一致结果将不可预知。

`-E`
这改变了分析规则，在遇到首个字符串不是按`spec`中的一个描述时不停止。它可用于测试或（如果和`-D`配合使用时）提取选项和他们的参数，忽略位置参数中的其他所有选项和参数。例如:

```
set -- -a -bx -c y -cz baz -cend
zparseopts a=foo b:=bar c+:=bar
//结果：
foo=(-a)
bar=(-b x -c y -c z)
```

'baz'后的参数将不会用到。


使用`-E`选项后：
```
set -- -a x -b y -c z arg1 arg2
zparseopts -E -D b:=bar
//结果：
bar=(-b y)
set -- -a x -c z arg1 arg2
```

这就是说，选项`-b`和它的参数从位置参数提取到数组`bar`。


`-M`选项可以这样使用：
```
set -- -a -bx -c y -cz baz -cend
zparseopts -A bar -M a=foo b+: c:=b
//结果：
foo=(-a)
bar=(-a '' -b xyz)
```
